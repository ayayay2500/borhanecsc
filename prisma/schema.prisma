// ملف prisma/schema.prisma

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// نموذج المستخدم
model User {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  telegramId Int      @unique
  username   String?
  firstName  String?
  lastName   String?
  points     Int      @default(0)
  status     Int      @default(0)  // 0 = نشط، 1 = محظور
  banReason  String?  
  photoUrl   String?
  adsCount   Int      @default(0)    
  lastAdDate DateTime @default(now()) 
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

// نموذج كود الهدايا - تم تحويل الكود إلى رقم Int
model GiftCode {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  code        Int        @unique // تم التغيير من String إلى Int لمنع المسافات
  points      Int        
  maxUses     Int        @default(1) 
  currentUses Int        @default(0) 
  createdAt   DateTime   @default(now())
  usedBy      UsedCode[]
}

// سجل الأكواد المستخدمة لمنع التكرار للمستخدم الواحد
model UsedCode {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  userId     Int      
  codeId     String   @db.ObjectId
  usedAt     DateTime @default(now())
  giftCode   GiftCode @relation(fields: [codeId], references: [id])

  @@unique([userId, codeId])
}
